package io.rxmicro.examples.data.mongo.all.operations;

import com.mongodb.reactivestreams.client.MongoDatabase;
import io.reactivex.rxjava3.core.Completable;
import io.reactivex.rxjava3.core.Single;
import io.rxmicro.data.detail.adapter.PublisherToRequiredMonoFutureAdapter;
import io.rxmicro.data.mongo.detail.AbstractMongoRepository;
import io.rxmicro.examples.data.mongo.all.operations.model.$$AccountEntityToMongoDBConverter;
import io.rxmicro.examples.data.mongo.all.operations.model.Account;
import org.bson.Document;
import reactor.core.publisher.Mono;

import java.util.concurrent.CompletableFuture;

/**
 * Generated by rxmicro annotation processor
 *
 * @link https://rxmicro.io
 */
public final class $$MongoInsertDataRepository extends AbstractMongoRepository implements InsertDataRepository {

    private final $$AccountEntityToMongoDBConverter accountEntityToMongoDBConverter =
            new $$AccountEntityToMongoDBConverter();

    public $$MongoInsertDataRepository(final MongoDatabase mongoDatabase) {
        super(InsertDataRepository.class, mongoDatabase.getCollection("collection"));
    }

    @Override
    public Mono<Account> insert1(final Account account) {
        final Document document = accountEntityToMongoDBConverter.toDB(account, true);
        return Mono.from(collection.insertOne(document))
                .map(s -> account)
                .doOnSuccess(a -> accountEntityToMongoDBConverter.setId(document, account));
    }

    @Override
    public Mono<Void> insert2(final Account account) {
        final Document document = accountEntityToMongoDBConverter.toDB(account, true);
        return Mono.from(collection.insertOne(document))
                .then()
                .doOnSuccess(a -> accountEntityToMongoDBConverter.setId(document, account));
    }

    @Override
    public Single<Account> insert3(final Account account) {
        final Document document = accountEntityToMongoDBConverter.toDB(account, true);
        return Single.fromPublisher(collection.insertOne(document))
                .map(s -> account)
                .doOnSuccess(a -> accountEntityToMongoDBConverter.setId(document, account));
    }

    @Override
    public Completable insert4(final Account account) {
        final Document document = accountEntityToMongoDBConverter.toDB(account, true);
        return Completable.fromPublisher(collection.insertOne(document))
                .doOnComplete(() -> accountEntityToMongoDBConverter.setId(document, account));
    }

    @Override
    public CompletableFuture<Account> insert5(final Account account) {
        final Document document = accountEntityToMongoDBConverter.toDB(account, true);
        return new PublisherToRequiredMonoFutureAdapter<>(
                collection.insertOne(document),
                useOptionalExceptionSupplier(CompletableFuture.class, Account.class)
        ).thenApply(s -> {
            accountEntityToMongoDBConverter.setId(document, account);
            return account;
        });
    }

    @Override
    public CompletableFuture<Void> insert6(final Account account) {
        final Document document = accountEntityToMongoDBConverter.toDB(account, true);
        return new PublisherToRequiredMonoFutureAdapter<>(
                collection.insertOne(document),
                useOptionalExceptionSupplier(CompletableFuture.class, Void.class)
        ).thenApply(s -> {
            accountEntityToMongoDBConverter.setId(document, account);
            return null;
        });
    }
}
