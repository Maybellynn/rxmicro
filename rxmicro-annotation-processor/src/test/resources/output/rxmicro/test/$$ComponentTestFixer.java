package rxmicro.test;

import java.util.Set;

import static io.rxmicro.common.util.ExCollections.unmodifiableOrderedSet;
import static io.rxmicro.common.util.InternalLoggers.logInfoTestMessage;
import static io.rxmicro.reflection.ReflectionConstants.RX_MICRO_REFLECTION_MODULE;

/**
 * Generated by {@code RxMicro Annotation Processor}
 */
public final class $$ComponentTestFixer {

    static {
        final Module currentModule = $$ComponentTestFixer.class.getModule();
        currentModule.addExports("rxmicro.test", RX_MICRO_REFLECTION_MODULE);
    }

    public $$ComponentTestFixer() {
        final Module currentModule = getClass().getModule();
        if (currentModule.isNamed()) {
            logInfoTestMessage("Fix the environment for component test(s)...");
            final Module unnamedModule = getClass().getClassLoader().getUnnamedModule();
            final Set<Module> modules = unmodifiableOrderedSet(unnamedModule, RX_MICRO_REFLECTION_MODULE);
            for (final Module module : modules) {
                for (final String packageName : currentModule.getPackages()) {
                    currentModule.addOpens(packageName, module);
                    logInfoTestMessage(
                            "opens ?/? to ?",
                            currentModule.getName(),
                            packageName,
                            module.isNamed() ? module.getName() : "ALL-UNNAMED"
                    );
                }
            }
        }
    }
}
