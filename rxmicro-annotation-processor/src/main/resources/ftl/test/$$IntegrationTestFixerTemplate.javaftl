<#include "../common-lib.javaftl">
<#-- -------------------------------------------------------------------------------------------------------- -->
public final class ${JAVA_CLASS_NAME} {

    static {
        final Module currentModule = ${JAVA_CLASS_NAME}.class.getModule();
        currentModule.addExports("${PACKAGE_NAME}", RX_MICRO_RUNTIME_MODULE);
    }

    public ${JAVA_CLASS_NAME}() {
        final Module currentModule = getClass().getModule();
        if (currentModule.isNamed()) {
            System.out.println("Fix the environment for integration test(s)...");
            final Module unnamedModule = getClass().getClassLoader().getUnnamedModule();
            final Set<Module> modules = Set.of(unnamedModule, RX_MICRO_COMMON_MODULE);
            for (final Module module : modules) {
                for (final String packageName : currentModule.getPackages()) {
                    currentModule.addOpens(packageName, module);
                    System.out.println(format(
                            "opens ?/? to ?",
                            currentModule.getName(),
                            packageName,
                            module.isNamed() ? module.getName() : "ALL-UNNAMED")
                    );
                }
            }
        }
    }
}
