<#include "../common-lib.javaftl">
<#-- -------------------------------------------------------------------------------------------------------- -->
public final class ${JAVA_CLASS_NAME} {

    static {
        final Module currentModule = ${JAVA_CLASS_NAME}.class.getModule();
        currentModule.addExports("${PACKAGE_NAME}", RX_MICRO_RUNTIME_MODULE);
    }

    public ${JAVA_CLASS_NAME}() {
        final Module currentModule = getClass().getModule();
        if (currentModule.isNamed()) {
            Stream.concat(
                    Stream.of(
                            getClass().getClassLoader().getUnnamedModule()
                    ),
                    Stream.of(
                            RX_MICRO_RUNTIME_MODULE,
                            RX_MICRO_COMMON_MODULE
                    ).filter(m -> m.isNamed())
            ).forEach(moduleName -> currentModule.getPackages().forEach(packageName -> {
                currentModule.addOpens(packageName, moduleName);
                System.out.println(format(
                        "opens ?/? to ?",
                        currentModule.getName(),
                        packageName,
                        moduleName.isNamed() ? moduleName.getName() : "ALL-UNNAMED")
                );
            }));
        }
    }
}